<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>UNDETALLIS — Confesarte</title>

  <!-- Firebase (compat para simplicidad) -->
  <script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-database-compat.js"></script>

  <style>
    :root{
      --neon: #00f7ff;
      --bg-overlay: rgba(0,0,0,0.45);
    }

    html,body{
      height:100%;
      margin:0;
      padding:0;
      font-family: "Inter", Arial, sans-serif;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      background: #000;
    }

    /* Fondo full, vibración muy marcada */
    .bg {
      position: fixed;
      inset: 0;
      background-image: url("assets/fondo.jpg");
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      z-index: 0;
      filter: saturate(1.05) contrast(1.02);
      animation: bgVibrate 0.08s infinite linear;
      will-change: transform;
    }

    @keyframes bgVibrate {
      0%   { transform: translate(0px, 0px) rotate(0deg) scale(1.00); }
      10%  { transform: translate(3px, -3px) rotate(-0.6deg) scale(1.005); }
      20%  { transform: translate(-3px, 4px) rotate(0.8deg) scale(1.006); }
      30%  { transform: translate(4px, -2px) rotate(-0.5deg) scale(1.004); }
      40%  { transform: translate(-4px, 3px) rotate(0.6deg) scale(1.007); }
      50%  { transform: translate(3px, 2px) rotate(-0.4deg) scale(1.002); }
      60%  { transform: translate(-2px, -3px) rotate(0.5deg) scale(1.003); }
      70%  { transform: translate(3px, 3px) rotate(-0.6deg) scale(1.005); }
      80%  { transform: translate(-3px, -2px) rotate(0.7deg) scale(1.006); }
      90%  { transform: translate(2px, 4px) rotate(-0.3deg) scale(1.004); }
      100% { transform: translate(0px, 0px) rotate(0deg) scale(1.00); }
    }

    /* overlay para oscurecer */
    .overlay {
      position: fixed;
      inset: 0;
      background: var(--bg-overlay);
      z-index: 1;
      pointer-events: none;
    }

    /* contenedor centrado */
    .wrap {
      position: relative;
      z-index: 2;
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 24px;
      box-sizing: border-box;
    }

    /* caja del texto */
    #texto {
      width: min(900px, 92%);
      background: #fff;
      border-radius: 22px;
      padding: 30px 36px;
      font-weight: 700;
      font-size: clamp(18px, 3.2vw, 28px);
      color: #000;
      text-align: center;
      line-height: 1.2;
      border: 3px solid rgba(255,255,255,0.98);
      /* neon glow */
      box-shadow:
        0 0 10px rgba(0,247,255,0.12),
        0 0 30px rgba(0,247,255,0.14),
        0 0 60px rgba(0,247,255,0.10);
      /* animacion extra del texto: pulso + leve movimiento */
      transform-origin: center;
      animation:
        neonPulse 1.6s ease-in-out infinite alternate,
        textFloat 6s ease-in-out infinite;
      will-change: transform, box-shadow;
      /* suave borde interior */
      backdrop-filter: blur(0.2px);
    }

    /* pulso neon */
    @keyframes neonPulse {
      0% {
        box-shadow:
          0 0 8px rgba(0,247,255,0.6),
          0 0 18px rgba(0,247,255,0.45),
          0 0 40px rgba(0,247,255,0.25);
        transform: translateY(0) scale(1);
      }
      100% {
        box-shadow:
          0 0 18px rgba(0,247,255,0.9),
          0 0 38px rgba(0,247,255,0.7),
          0 0 80px rgba(0,247,255,0.45);
        transform: translateY(-4px) scale(1.01);
      }
    }

    /* leve flotar + rotación sutil */
    @keyframes textFloat {
      0% { transform: translateY(0) rotate(0deg); }
      25% { transform: translateY(-6px) rotate(-0.6deg); }
      50% { transform: translateY(3px) rotate(0.5deg); }
      75% { transform: translateY(-3px) rotate(-0.3deg); }
      100% { transform: translateY(0) rotate(0deg); }
    }

    /* efecto flicker muy sutil para dar vida */
    .flicker {
      display:inline-block;
      animation: flickerAnim 3.4s steps(2, end) infinite;
    }

    @keyframes flickerAnim {
      0% { opacity: 1; filter: drop-shadow(0 0 6px rgba(0,247,255,0.6)); }
      5% { opacity: 0.95; filter: drop-shadow(0 0 4px rgba(0,247,255,0.55)); }
      10% { opacity: 1; filter: drop-shadow(0 0 6px rgba(0,247,255,0.6)); }
      100% { opacity: 1; }
    }

    /* responsivo: menos padding en pantalla chica */
    @media (max-width:420px) {
      #texto { padding: 18px 16px; font-size: 18px; border-radius: 16px; }
    }
  </style>
</head>
<body>
  <div class="bg" aria-hidden="true"></div>
  <div class="overlay" aria-hidden="true"></div>

  <main class="wrap">
    <div id="texto" aria-live="polite"><span class="flicker">Cargando...</span></div>
  </main>

  <script>
    /* ================== FIREBASE CONFIG ================== */
    const firebaseConfig = {
      apiKey: "AIzaSyCJ8sSO65rTjF04Dl7VMEuhrLj_Z9yAICs",
      authDomain: "undetallis.firebaseapp.com",
      databaseURL: "https://undetallis-default-rtdb.firebaseio.com",
      projectId: "undetallis",
      storageBucket: "undetallis.firebasestorage.app",
      messagingSenderId: "60709183880",
      appId: "1:60709183880:web:c7751f216ca7f5ad381a3d",
      measurementId: "G-5ZQY4JZBGX"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    /* ================== MENSAJES (120) ================== */
    const mensajes = [
"¿Quién fue tu último crush?",
"¿Qué es lo primero que notas en alguien?",
"¿Cuál ha sido tu mayor metida de pata?",
"¿Qué es algo que te da pena admitir?",
"¿Qué es lo más loco que has hecho por amor?",
"¿Qué es algo que nunca le has contado a nadie?",
"¿Cuál ha sido tu sueño más raro?",
"¿Cuál fue tu peor cita?",
"¿Cuál es tu fantasía más inocente?",
"Menciona un secreto chiquito",
"¿Quién te parece atractiv@ del grupo?",
"¿Cuál es tu tipo de persona ideal?",
"¿Qué es lo más atrevido que has hecho en público?",
"¿Qué parte de tu cuerpo te gusta más?",
"¿Qué te derrite instantáneamente?",
"¿Cuál fue tu beso más memorable?",
"¿Qué es lo más loco que has enviado por mensaje?",
"¿Qué es lo que más te prende de alguien?",
"¿Qué es lo más prohibido que has hecho?",
"¿Preferirías besar a alguien aquí o mandar un mensaje vergonzoso?",
"¿Regresarías con tu ex?",
"¿Perdonarías una infidelidad?",
"¿Mentirías por alguien que amas?",
"¿Qué elegirías: amor o dinero?",
"¿Preferirías saber la verdad siempre o vivir feliz sin saber?",
"¿Qué prefieres: beso robado o beso lento?",
"¿Qué prefieres: alguien celoso o alguien demasiado libre?",
"¿Viajar al pasado o al futuro?",
"¿Decir siempre la verdad o no poder decir nada?",
"¿Amor intenso o amor estable?",
"¿Cuál es tu mayor cringe?",
"¿Qué te da más vergüenza admitir?",
"¿Cuál fue tu peor look de la vida?",
"Imita un sonido que te dé pena",
"¿Cuál es tu apodo más feo?",
"¿Qué rumor ridículo han dicho de ti?",
"¿Qué mentira piadosa dices siempre?",
"¿Cuál es tu guilty pleasure?",
"¿Qué comida te encanta pero te da pena pedir?",
"¿Cuál es tu verdadero yo tóxico?",
"Mira a alguien fijo por 5 segundos y pídele que confiese algo",
"Di la primera palabra que pienses… y explícalo",
"Di algo bonito de la persona a tu derecha",
"Imita a tu crush imaginario",
"Describe tu cita ideal en 10 segundos",
"Cuenta un secreto en clave",
"Di tu confesión susurrándola",
"Da un halago sincero a alguien del grupo",
"Haz una confesión usando solo 3 palabras",
"Explica tu última conversación rara de WhatsApp",
"¿Qué te gustaría cambiar de tu pasado?",
"¿Qué te da miedo que la gente descubra?",
"¿Qué te falta para ser feliz?",
"¿Qué te arrepientes de no haber dicho?",
"¿Qué te motiva más en la vida?",
"¿Qué herida del pasado aún te afecta?",
"¿Cuál ha sido tu momento más vulnerable?",
"¿Qué estás evitando últimamente?",
"¿A quién extrañas pero no contactas?",
"¿Qué te gustaría decirle a alguien pero no te atreves?",
"¿Qué es algo que quisieras intentar pero te da pena?",
"¿Qué es lo más impulsivo que has hecho?",
"¿Quién aquí te intimida un poquito?",
"Describe un recuerdo que todavía te da vergüenza",
"¿Qué conversación evitaste últimamente?",
"¿Qué te enamora sin esfuerzo?",
"¿Qué es algo que haces solo cuando nadie te ve?",
"Cuenta una mentira obvia como si fuera verdad",
"¿Qué es lo que más te cuesta admitir?",
"¿Qué canción te da pena aceptar que te gusta?",
"¿Quién fue tu amor platónico más raro?",
"¿Qué es lo más inmaduro que has hecho por alguien?",
"¿Cuál fue tu peor decisión por un impulso?",
"Haz una confesión sobre la persona que tengas enfrente",
"¿Qué hábito extraño tienes?",
"Di algo bonito que nadie sabe de ti",
"¿Qué es lo más cursi que has dicho?",
"¿Qué te dolió más de tu última relación?",
"¿Qué te haría sonrojar ahora mismo?",
"¿Cuál sería tu cita perfecta sin gastar dinero?",
"Confiesa algo que siempre pospones",
"Imita tu reacción cuando ves a alguien que te gusta",
"¿Qué es lo más raro que coleccionas o coleccionabas?",
"¿Qué te vuelve débil emocionalmente?",
"¿Qué mensaje te gustaría recibir hoy?",
"¿Qué persona marcó tu vida sin saberlo?",
"¿Qué sueño no le has contado a nadie?",
"¿Qué aprendiste de tu peor error?",
"¿Qué es lo más loco que hiciste estando feliz?",
"¿Qué frase te gustaría que alguien te dijera?",
"¿Qué hábito de otros te encanta secretamente?",
"¿Qué rumor inventarían de ti?",
"¿Qué es lo más sincero que has dicho sin querer?",
"¿Qué gesto pequeño te enamora?",
"¿Qué personalidad te derrite?",
"¿Qué es lo que más te cuesta soltar?",
"Di una confesión que solo entiendas tú",
"¿Qué pensamiento random tuviste hoy?",
"¿Qué habilidad tuya subestimas?",
"¿Qué parte de tu personalidad ocultas?",
"¿Qué cambiarías de tus decisiones pasadas?",
"¿Qué secreto gracioso tienes?",
"¿Qué harías si hoy fuera tu último día tranquilamente?",
"¿Qué es lo más raro que te gusta de alguien?",
"¿Qué fue lo último que te hizo sentir vivo?",
"¿Qué es lo que siempre quisiste decir y no dijiste?",
"¿Qué recuerdo tuyo siempre te hace reír?",
"¿Qué cosa inocente te vuelve nervioso?",
"¿Qué te gustaría hacer por primera vez este año?",
"¿Qué te enamora sin razones?",
"¿Cuál fue tu crush más inesperado?",
"¿Cuál es tu teoría más loca pero lógica?",
"¿Qué es algo que harías si nadie te juzgara?",
"¿Qué secreto solo tus amigos cercanos saben?",
"¿Qué es lo más ridículo que defendiste alguna vez?",
"Di algo que te hubiera gustado escuchar hoy",
"¿Qué vibra quieres dejar en las personas?",
"¿Qué es lo más valiente que hiciste sin pensarlo?",
"¿Qué es lo más honesto que te han dicho?",
"¿Qué te da miedo que descubran de ti?",
"¿Qué momento de tu vida repetirías?"
    ];

    /* ================== LÓGICA SECUENCIAL GLOBAL ==================
       - Cada visita realiza UNA transaction atómica que avanza el
         contador en la DB y devuelve el valor COMMITED (nuevo).
       - El mensaje mostrado en el dispositivo es el índice anterior:
         displayedIndex = (newValue - 1 + len) % len
       - Si la DB está vacía, iniciamos adecuadamente.
       ============================================================ */

    const ref = db.ref('confesarte/index'); // ruta en Realtime DB

    function showLocalMessage(idx) {
      const el = document.getElementById('texto');
      const text = mensajes[idx] || "...";
      // wrap parte con flicker para mantener efecto
      el.innerHTML = `<span class="flicker">${escapeHtml(text)}</span>`;
    }

    function escapeHtml(s){
      return String(s)
        .replaceAll('&','&amp;')
        .replaceAll('<','&lt;')
        .replaceAll('>','&gt;')
        .replaceAll('"','&quot;')
        .replaceAll("'",'&#39;');
    }

    // Ejecuta transaction atómica
    function claimNextMessage(){
      const len = mensajes.length;

      ref.transaction(function(current){
        // current = valor actual en la DB (el índice "actual" ya reservado para siguiente)
        if (current === null || current === undefined || isNaN(current)) {
          // Si no hay valor, escribimos 1 (el siguiente), lo que implica mostrar el índice 0 aquí.
          return 1;
        }
        // Siguiente valor (cíclico)
        let next = parseInt(current, 10) + 1;
        if (next >= len) next = 0;
        return next;
      }, function(error, committed, snapshot){
        if (error) {
          // Si falla la transacción, mostramos la primera frase como fallback
          console.error('Transaction failed:', error);
          try { showLocalMessage(0); } catch(e){}
          return;
        }
        if (!committed) {
          // No se comprometió, fallback
          showLocalMessage(0);
          return;
        }
        const newVal = snapshot.val();
        // El valor comprometido es el "siguiente" para el próximo visitante.
        // El mensaje que debemos mostrar aquí es (newVal - 1 + len) % len
        const displayedIndex = ((parseInt(newVal,10) - 1) + len) % len;
        showLocalMessage(displayedIndex);
      }, false); // valor: applyLocally=false para evitar doble-trigger localmente
    }

    // Llamar al cargar la página
    claimNextMessage();

    /* OPTIONAL: si quieres que cambie automáticamente cada X segundos (descomentar)
    setInterval(() => {
      claimNextMessage();
    }, 10000); // cada 10s
    */

    // Seguridad visual: si Firebase no responde en 2s, mostrar 1er mensaje
    setTimeout(() => {
      const el = document.getElementById('texto');
      if (el && el.textContent.trim() === '' || el.textContent.includes('Cargando')) {
        showLocalMessage(0);
      }
    }, 2000);
  </script>
</body>
</html>
